<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: Arial, sans-serif;
      padding: 0;
      background: #f5f5f5;
      margin: 0;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .header h2 {
      margin: 0;
      font-size: 20px;
    }
    
    .header p {
      margin: 5px 0 0 0;
      font-size: 12px;
      opacity: 0.9;
    }
    
    /* TABS DE NAVEGAÃ‡ÃƒO */
    .tabs {
      display: flex;
      background: white;
      border-bottom: 2px solid #e0e0e0;
      overflow-x: auto;
    }
    
    .tab {
      flex: 1;
      padding: 12px 8px;
      text-align: center;
      cursor: pointer;
      border: none;
      background: white;
      color: #666;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s;
      white-space: nowrap;
    }
    
    .tab:hover {
      background: #f5f5f5;
    }
    
    .tab.active {
      color: #667eea;
      border-bottom: 3px solid #667eea;
      margin-bottom: -2px;
    }
    
    /* CONTEÃšDO DAS ABAS */
    .tab-content {
      display: none;
      padding: 15px;
      animation: fadeIn 0.3s;
    }
    
    .tab-content.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .config-group {
      background: white;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .config-group h3 {
      margin: 0 0 15px 0;
      font-size: 16px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #555;
      font-size: 13px;
    }
    
    input[type="text"],
    input[type="number"],
    input[type="email"],
    textarea,
    select {
      width: 100%;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 14px;
      font-family: Arial, sans-serif;
      transition: border-color 0.3s;
    }
    
    textarea {
      resize: vertical;
      min-height: 80px;
      font-family: 'Courier New', monospace;
    }
    
    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .checkbox-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 6px;
    }
    
    .checkbox-wrapper input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      margin: 0;
    }
    
    .checkbox-wrapper label {
      margin: 0;
      cursor: pointer;
      flex: 1;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 14px 24px;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-size: 15px;
      font-weight: bold;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 6px rgba(102, 126, 234, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-size: 14px;
      font-weight: bold;
      margin-top: 10px;
      transition: all 0.2s;
    }
    
    .btn-secondary:hover {
      background: #f0f4ff;
    }
    
    .btn-small {
      padding: 6px 12px;
      font-size: 12px;
      width: auto;
      margin-top: 5px;
    }
    
    .status {
      padding: 12px;
      border-radius: 6px;
      margin-top: 15px;
      display: none;
      font-size: 14px;
      font-weight: 500;
      position: sticky;
      bottom: 0;
      background: white;
      z-index: 10;
    }
    
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }
    
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }
    
    .status.loading {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
      display: block;
    }
    
    .help-text {
      font-size: 12px;
      color: #6c757d;
      margin-top: -10px;
      margin-bottom: 15px;
    }
    
    .info-box {
      background: #e7f3ff;
      border-left: 4px solid #2196f3;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 4px;
      font-size: 13px;
      color: #0d47a1;
    }
    
    .info-box strong {
      display: block;
      margin-bottom: 5px;
    }
    
    .divider {
      height: 1px;
      background: #e0e0e0;
      margin: 20px 0;
    }
    
    /* LISTA DE BUCKETS */
    .bucket-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .bucket-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 6px;
      margin-bottom: 8px;
    }
    
    .bucket-item input {
      flex: 1;
      margin: 0;
    }
    
    .bucket-item button {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .bucket-item button:hover {
      background: #c82333;
    }
    
    /* SELETOR DE ABA */
    .aba-selector {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 15px;
    }
    
    .aba-selector label {
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  
  <div class="header">
    <h2>âš™ï¸ Configurador RADAR</h2>
    <p>Sistema de GestÃ£o de Tarefas do Planner</p>
  </div>
  
  <!-- TABS DE NAVEGAÃ‡ÃƒO -->
  <div class="tabs">
    <button class="tab active" onclick="abrirTab('basico')">âš¡ BÃ¡sico</button>
    <button class="tab" onclick="abrirTab('templates')">ğŸ“ Templates</button>
    <button class="tab" onclick="abrirTab('buckets')">ğŸª£ Buckets</button>
    <button class="tab" onclick="abrirTab('avancado')">ğŸ”§ AvanÃ§ado</button>
  </div>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- TAB 1: CONFIGURAÃ‡Ã•ES BÃSICAS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="tab-basico" class="tab-content active">
    
    <div class="info-box">
      <strong>ğŸ’¡ Dica</strong>
      ConfiguraÃ§Ãµes bÃ¡sicas de execuÃ§Ã£o e e-mail.
    </div>
    
    <div class="config-group">
      <h3>âš¡ AtivaÃ§Ã£o do Sistema</h3>
      <div class="checkbox-wrapper">
        <input type="checkbox" id="enabled" checked>
        <label for="enabled">Sistema RADAR Ativo</label>
      </div>
      <p class="help-text">Desative temporariamente sem remover configuraÃ§Ãµes</p>
    </div>
    
    <div class="config-group">
      <h3>â° Agendamentos AutomÃ¡ticos</h3>
      
      <label for="triggerFrequencia">FrequÃªncia de ExecuÃ§Ã£o:</label>
      <select id="triggerFrequencia" onchange="toggleIntervaloHoras()">
        <option value="UMA_VEZ_DIA">Uma vez ao dia</option>
        <option value="INTERVALO_HORAS">A cada N horas</option>
        <option value="HORA_EM_HORA">De hora em hora</option>
      </select>
      <p class="help-text">Controla quando o RADAR executa automaticamente</p>
      
      <div id="intervaloHorasDiv" style="display: none; margin-top: 10px;">
        <label for="triggerIntervaloHoras">Intervalo em Horas:</label>
        <input type="number" id="triggerIntervaloHoras" min="1" max="12" value="4">
        <p class="help-text">Executar a cada quantas horas (1-12)</p>
      </div>
      
      <div class="divider"></div>
      
      <label for="horaImediato">Hora ExecuÃ§Ã£o Imediato (0-23):</label>
      <input type="number" id="horaImediato" min="0" max="23" value="20">
      <p class="help-text">HorÃ¡rio fixo quando modo = "Uma vez ao dia" (padrÃ£o: 20h)</p>
      
      <label for="horaConferencia">Hora ExecuÃ§Ã£o ConferÃªncia (0-23):</label>
      <input type="number" id="horaConferencia" min="0" max="23" value="6">
      <p class="help-text">VerificaÃ§Ã£o matinal de prioridades (padrÃ£o: 6h)</p>
      
      <div class="divider"></div>
      
      <label for="horaInicioExpediente">InÃ­cio do Expediente (0-23):</label>
      <input type="number" id="horaInicioExpediente" min="0" max="23" value="6">
      <p class="help-text">RADAR sÃ³ executa a partir deste horÃ¡rio</p>
      
      <label for="horaFimExpediente">Fim do Expediente (0-23):</label>
      <input type="number" id="horaFimExpediente" min="0" max="23" value="18">
      <p class="help-text">RADAR nÃ£o executa apÃ³s este horÃ¡rio</p>
    </div>
    
    <div class="config-group">
      <h3>ğŸ“§ ConfiguraÃ§Ãµes de E-mail</h3>
      
      <label for="emailDestinatario">DestinatÃ¡rio:</label>
      <input type="email" id="emailDestinatario" value="jefferson.santos@basa.com.br">
      <p class="help-text">E-mail que receberÃ¡ o JSON para Power Automate</p>
      
      <label for="assunto">Assunto do E-mail:</label>
      <input type="text" id="assunto" value="RADAR_PLANNER">
      <p class="help-text">Mantenha consistente com filtro do Power Automate</p>
    </div>
    
    <div class="config-group">
      <h3>ğŸ“Š Limites de Processamento</h3>
      
      <label for="maxItens">MÃ¡ximo de Itens por Envio:</label>
      <input type="number" id="maxItens" min="1" max="100" value="50">
      <p class="help-text">Limite de tarefas enviadas por execuÃ§Ã£o (1-100)</p>
      
      <label for="maxItensConferencia">MÃ¡ximo em Modo ConferÃªncia:</label>
      <input type="number" id="maxItensConferencia" min="1" max="50" value="25">
      <p class="help-text">Limite para execuÃ§Ã£o de conferÃªncia (1-50)</p>
    </div>
    
  </div>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- TAB 2: TEMPLATES POR ABA -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="tab-templates" class="tab-content">
    
    <div class="info-box">
      <strong>ğŸ“ Templates de TÃ­tulo e DescriÃ§Ã£o</strong>
      Use {LETRA} para inserir valores de colunas. Ex: {B} = Coluna B, {G} = Coluna G
    </div>
    
    <div class="aba-selector">
      <label for="abaSelect">Selecione a Aba:</label>
      <select id="abaSelect" onchange="carregarTemplatesAba()">
        <option value="DEMANDAS DIVERSASğŸ”§">DEMANDAS DIVERSASğŸ”§</option>
        <option value="SEGUROSğŸ›¡ï¸">SEGUROSğŸ›¡ï¸</option>
        <option value="INTERNALIZADOğŸ¯">INTERNALIZADOğŸ¯</option>
        <option value="EM ANALISEğŸ“Š">EM ANALISEğŸ“Š</option>
        <option value="CADASTROSğŸ§‘â€ğŸ’»">CADASTROSğŸ§‘â€ğŸ’»</option>
      </select>
    </div>
    
    <div class="config-group">
      <h3>ğŸ“Œ Template de TÃ­tulo</h3>
      
      <label for="templateTitulo">Template:</label>
      <textarea id="templateTitulo" placeholder="{B} | {G} / {H}"></textarea>
      <p class="help-text">Exemplo: {B} | {G} / {H} = "CLIENTE | SITUACAO / DETALHE"</p>
    </div>
    
    <div class="config-group">
      <h3>ğŸ“„ Template de DescriÃ§Ã£o</h3>
      
      <label for="templateDescricao">Template:</label>
      <textarea id="templateDescricao" placeholder="DOCSFLOW: {F}\nComentÃ¡rio: {I}"></textarea>
      <p class="help-text">Use \n para quebra de linha</p>
    </div>
    
    <div class="config-group">
      <h3>ğŸ‘¤ AtribuiÃ§Ã£o Fixa (Opcional)</h3>
      
      <label for="assignedToFixo">E-mail do ResponsÃ¡vel:</label>
      <input type="email" id="assignedToFixo" placeholder="usuario@basa.com.br">
      <p class="help-text">Deixe em branco para nÃ£o atribuir automaticamente</p>
    </div>
    
  </div>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- TAB 3: BUCKETS VÃLIDOS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="tab-buckets" class="tab-content">
    
    <div class="info-box">
      <strong>ğŸª£ Buckets do Planner</strong>
      Configure os nomes vÃ¡lidos de buckets que podem ser usados pelo RADAR.
    </div>
    
    <div class="config-group">
      <h3>Lista de Buckets</h3>
      
      <ul id="bucketList" class="bucket-list">
        <!-- Preenchido dinamicamente -->
      </ul>
      
      <button class="btn-secondary btn-small" onclick="adicionarBucket()">â• Adicionar Bucket</button>
    </div>
    
  </div>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- TAB 4: CONFIGURAÃ‡Ã•ES AVANÃ‡ADAS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="tab-avancado" class="tab-content">
    
    <div class="info-box">
      <strong>ğŸ”§ ConfiguraÃ§Ãµes AvanÃ§adas</strong>
      Modifique apenas se souber o que estÃ¡ fazendo.
    </div>
    
    <div class="config-group">
      <h3>ğŸ¯ Modo ConferÃªncia</h3>
      
      <label for="minPrioridade">Prioridade MÃ­nima para ConferÃªncia:</label>
      <input type="number" id="minPrioridade" min="0" max="10" value="2">
      <p class="help-text">Apenas itens com prioridade â‰¤ este valor (0-10)</p>
    </div>
    
    <div class="config-group">
      <h3>ğŸ“Š Mapeamento de Prioridades</h3>
      
      <label>Prioridade Planilha â†’ Planner:</label>
      <div class="help-text" style="margin-top: 0;">
        0-1 = Urgente (1) | 2-4 = Importante (3) | 5-7 = Normal (5) | 8-10 = Baixa (9)
      </div>
      <p class="help-text">Este mapeamento estÃ¡ fixo no cÃ³digo. Use prioridades de 0-10 na planilha.</p>
    </div>
    
    <button class="btn-secondary" onclick="restaurarPadroes()">ğŸ”„ Restaurar Todos os PadrÃµes</button>
    
  </div>
  
  <!-- BOTÃƒO DE SALVAR (FIXO NO FUNDO) -->
  <div style="padding: 15px; background: #f5f5f5;">
    <button class="btn-primary" onclick="salvarConfig()">ğŸ’¾ Salvar ConfiguraÃ§Ãµes</button>
    <div id="status" class="status"></div>
  </div>
  
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // VARIÃVEIS GLOBAIS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    let configCache = {};
    let templatesCache = {};
    let bucketsCache = [];
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // NAVEGAÃ‡ÃƒO ENTRE TABS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function abrirTab(tabName) {
      // Esconde todas as tabs
      const tabs = document.getElementsByClassName('tab-content');
      for (let i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove('active');
      }
      
      // Remove active dos botÃµes
      const tabButtons = document.getElementsByClassName('tab');
      for (let i = 0; i < tabButtons.length; i++) {
        tabButtons[i].classList.remove('active');
      }
      
      // Mostra tab selecionada
      document.getElementById('tab-' + tabName).classList.add('active');
      event.target.classList.add('active');
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TOGGLE VISIBILIDADE DO CAMPO INTERVALO HORAS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function toggleIntervaloHoras() {
      const freq = document.getElementById('triggerFrequencia').value;
      const intervaloDiv = document.getElementById('intervaloHorasDiv');
      
      if (freq === 'INTERVALO_HORAS') {
        intervaloDiv.style.display = 'block';
      } else {
        intervaloDiv.style.display = 'none';
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INICIALIZAÃ‡ÃƒO
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    window.onload = function() {
      mostrarStatus('Carregando configuraÃ§Ãµes...', 'loading');
      
      google.script.run
        .withSuccessHandler(function(config) {
          configCache = config;
          preencherFormulario(config);
          carregarTemplatesAba(); // Carrega primeira aba
          renderizarBuckets(config.buckets || []);
          ocultarStatus();
        })
        .withFailureHandler(function(error) {
          mostrarStatus('âŒ Erro ao carregar: ' + error, 'error');
        })
        .getConfigCompleta();
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PREENCHE FORMULÃRIO - TAB BÃSICO
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function preencherFormulario(config) {
      document.getElementById('enabled').checked = config.enabled;
      document.getElementById('horaImediato').value = config.horaImediato;
      document.getElementById('horaConferencia').value = config.horaConferencia;
      document.getElementById('emailDestinatario').value = config.emailDestinatario;
      document.getElementById('assunto').value = config.assunto || 'RADAR_PLANNER';
      document.getElementById('maxItens').value = config.maxItens;
      document.getElementById('maxItensConferencia').value = config.maxItensConferencia || '25';
      document.getElementById('minPrioridade').value = config.minPrioridade || '2';
      document.getElementById('triggerFrequencia').value = config.triggerFrequencia || 'UMA_VEZ_DIA';
      document.getElementById('triggerIntervaloHoras').value = config.triggerIntervaloHoras || '4';
      document.getElementById('horaInicioExpediente').value = config.horaInicioExpediente || '6';
      document.getElementById('horaFimExpediente').value = config.horaFimExpediente || '18';
      
      // Atualiza visibilidade do campo intervalo
      toggleIntervaloHoras();
      
      // Salva templates em cache
      templatesCache = config.templates || {};
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CARREGA TEMPLATES DA ABA SELECIONADA
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function carregarTemplatesAba() {
      const abaSelect = document.getElementById('abaSelect');
      const abaSelecionada = abaSelect.value;
      
      const templates = templatesCache[abaSelecionada] || {
        titulo: '',
        description: '',
        assignedTo: ''
      };
      
      document.getElementById('templateTitulo').value = templates.titulo || '';
      document.getElementById('templateDescricao').value = templates.description || '';
      document.getElementById('assignedToFixo').value = templates.assignedTo || '';
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GERENCIAMENTO DE BUCKETS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function renderizarBuckets(buckets) {
      bucketsCache = buckets;
      const lista = document.getElementById('bucketList');
      lista.innerHTML = '';
      
      buckets.forEach((bucket, index) => {
        const li = document.createElement('li');
        li.className = 'bucket-item';
        li.innerHTML = `
          <input type="text" value="${bucket}" onchange="editarBucket(${index}, this.value)">
          <button onclick="removerBucket(${index})">ğŸ—‘ï¸</button>
        `;
        lista.appendChild(li);
      });
    }
    
    function adicionarBucket() {
      bucketsCache.push('NOVO BUCKET');
      renderizarBuckets(bucketsCache);
    }
    
    function editarBucket(index, novoValor) {
      bucketsCache[index] = novoValor.toUpperCase().trim();
    }
    
    function removerBucket(index) {
      if (confirm('Remover este bucket?')) {
        bucketsCache.splice(index, 1);
        renderizarBuckets(bucketsCache);
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SALVA TODAS AS CONFIGURAÃ‡Ã•ES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function salvarConfig() {
      // Salva templates da aba atual antes de enviar
      salvarTemplateAtual();
      
      const config = {
        // Tab BÃ¡sico
        enabled: document.getElementById('enabled').checked,
        horaImediato: document.getElementById('horaImediato').value,
        horaConferencia: document.getElementById('horaConferencia').value,
        emailDestinatario: document.getElementById('emailDestinatario').value,
        assunto: document.getElementById('assunto').value,
        maxItens: document.getElementById('maxItens').value,
        maxItensConferencia: document.getElementById('maxItensConferencia').value,
        triggerFrequencia: document.getElementById('triggerFrequencia').value,
        triggerIntervaloHoras: document.getElementById('triggerIntervaloHoras').value,
        horaInicioExpediente: document.getElementById('horaInicioExpediente').value,
        horaFimExpediente: document.getElementById('horaFimExpediente').value,
        
        // Tab Templates
        templates: templatesCache,
        
        // Tab Buckets
        buckets: bucketsCache,
        
        // Tab AvanÃ§ado
        minPrioridade: document.getElementById('minPrioridade').value
      };
      
      mostrarStatus('ğŸ’¾ Salvando configuraÃ§Ãµes...', 'loading');
      
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            mostrarStatus('âœ… ConfiguraÃ§Ãµes salvas com sucesso!', 'success');
            setTimeout(() => ocultarStatus(), 3000);
          } else {
            mostrarStatus('âŒ Erro: ' + (result.error || 'Erro desconhecido'), 'error');
          }
        })
        .withFailureHandler(function(error) {
          mostrarStatus('âŒ Erro ao salvar: ' + error, 'error');
        })
        .saveConfigCompleta(config);
    }
    
    function salvarTemplateAtual() {
      const abaSelect = document.getElementById('abaSelect');
      const abaSelecionada = abaSelect.value;
      
      templatesCache[abaSelecionada] = {
        titulo: document.getElementById('templateTitulo').value,
        description: document.getElementById('templateDescricao').value,
        assignedTo: document.getElementById('assignedToFixo').value
      };
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RESTAURAR PADRÃ•ES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function restaurarPadroes() {
      if (!confirm('Deseja realmente restaurar TODAS as configuraÃ§Ãµes para os valores padrÃ£o?')) {
        return;
      }
      
      google.script.run
        .withSuccessHandler(function(config) {
          preencherFormulario(config);
          carregarTemplatesAba();
          renderizarBuckets(config.buckets);
          mostrarStatus('ğŸ”„ PadrÃµes restaurados. Clique em "Salvar" para aplicar.', 'loading');
        })
        .withFailureHandler(function(error) {
          mostrarStatus('âŒ Erro: ' + error, 'error');
        })
        .restaurarPadroesCompletos();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FUNÃ‡Ã•ES AUXILIARES DE UI
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function mostrarStatus(mensagem, tipo) {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = mensagem;
      statusDiv.className = 'status ' + tipo;
    }
    
    function ocultarStatus() {
      setTimeout(() => {
        const statusDiv = document.getElementById('status');
        statusDiv.style.display = 'none';
      }, 500);
    }
  </script>
</body>
</html>